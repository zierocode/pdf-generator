# =============================================================================
# PDF Generator — Mazuma Service
# Copy this file to .env and fill in values before running.
# Leave any value blank to use the default (dev-friendly mode).
# =============================================================================

# -----------------------------------------------------------------------------
# Server
# -----------------------------------------------------------------------------

# Port the HTTP server listens on (inside the container).
PORT=3000

# Host port exposed on the VPS (change this if 3000 is already taken).
# Example: HOST_PORT=4500 → http://your-vps:4500
HOST_PORT=3000

NODE_ENV=production

# -----------------------------------------------------------------------------
# Authentication
# -----------------------------------------------------------------------------

# API key required on every request (header: X-API-Key).
# Leave EMPTY to disable auth — useful in local dev, never do this in production.
# Generate a key: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
PDF_API_KEY=

# -----------------------------------------------------------------------------
# CORS
# -----------------------------------------------------------------------------

# Comma-separated list of allowed origins for browser requests.
# Leave EMPTY to allow all origins (fine for dev / internal-only deployments).
# Example: https://app.mazuma.co.th,https://admin.mazuma.co.th
CORS_ORIGINS=

# -----------------------------------------------------------------------------
# Rate Limiting  (applies per IP across all endpoints)
# -----------------------------------------------------------------------------

# THROTTLE_TTL    — sliding window duration in seconds.
# THROTTLE_LIMIT  — max requests allowed within that window.
# Default: 30 requests per 60 seconds per IP.
# Increase if legitimate clients need higher throughput.
THROTTLE_TTL=60
THROTTLE_LIMIT=30

# -----------------------------------------------------------------------------
# PDF Concurrency
#
# How many Chrome pages can render simultaneously, and how to handle overflow.
#
# Memory reference (per active Chrome page):
#   ~80 MB  — base Chrome process overhead
#   ~40 MB  — 417 KB inlined CSS + logo image decoded in memory
#   ~30 MB  — DOM, render buffer, font rasterization
#   ──────────────────────────────────────────
#   ~150 MB total (peak, released when page.close() is called)
#
# Sizing guide — set PDF_MAX_CONCURRENT based on available server RAM:
#   512 MB server  →  2   (leaves ~200 MB for OS + Node)
#     1 GB server  →  3
#     2 GB server  →  5   ← default
#     4 GB server  → 10
# -----------------------------------------------------------------------------

# Max Chrome pages open at the same time.
# Requests beyond this limit are queued (not rejected) until a slot is free.
PDF_MAX_CONCURRENT=2

# Max requests that can wait in the queue when all slots are busy.
# If the queue is full, the server returns 503 immediately
# rather than letting the queue grow without bound.
PDF_MAX_QUEUE=30

# How long (ms) a queued request will wait before giving up.
# If a slot doesn't free up in time, the request fails with a timeout error.
# 60000 = 60 seconds — generous enough for burst traffic, short enough to fail fast.
PDF_QUEUE_TIMEOUT_MS=60000
