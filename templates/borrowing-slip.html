<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <!--
    PDF Template: ใบยืมสินค้า/อะไหล่
    ─────────────────────────────────
    Handlebars  (use double curly braces — shown here with backslash-escape to avoid parsing):
      \{{var}}            variable substitution
      \{{{var}}}          raw / no HTML escape (use for data URIs)
      \{{#each items}}    loop
      \{{dateFormat x}}   \{{numberFormat x 2}}   \{{valueOrDash x}}   \{{checkMark x}}

    Puppeteer options — add this block anywhere in <body> to override PDF rendering defaults:
      [script type="application/pdf-options"]
      {
        "footerTemplate": "<div style='font-size:9px;...'>text | <span class='pageNumber'></span> / <span class='totalPages'></span></div>",
        "headerTemplate": "<div style='...'>custom header</div>",
        "margin": { "top": "0", "right": "0", "bottom": "12mm", "left": "0" },
        "landscape": false,
        "scale": 1
      }
      [/script]
      - Handlebars variables inside the JSON are already resolved (e.g. \{{documentNo}} works)
      - footer/headerTemplate support Puppeteer classes: pageNumber, totalPages, date, title, url
      - Omit entire block to use defaults: auto page numbers at bottom-right, 8mm bottom margin

    Layout:
      Outer <table class="page-layout"> with <thead> repeating on every page (browser-native)
      No position:fixed needed — thead auto-repeats via CSS table-header-group

    Preview: http://localhost:3000 (serves /assets/ for fonts + images)
  -->
  <link rel="stylesheet" href="/assets/pdf-base.css">
  <style>
    /* ════════════════════════════════════════════════════════════════
       ░░  TEMPLATE CONFIGURATION — edit this section to tune layout  ░░
       ════════════════════════════════════════════════════════════════
       CSS variables work in all regular rules below.
       Two exceptions where var() is NOT supported by the browser:
         • @page rules  → hardcoded, marked ⚠ SYNC
         • pdf-options JSON block  → hardcoded, marked ⚠ SYNC
       ════════════════════════════════════════════════════════════════ */
    :root {
      /* ── Page geometry ──────────────────────────────────────────── */
      --pg-h:       8mm;   /* left/right padding: header, content, footer */
      --pg-top:     6mm;   /* top padding inside page header */
      --pg-bottom:  20mm;  /* ⚠ SYNC → @page margin-bottom (below)
                                     → pdf-options "margin.bottom" (JSON block) */

      /* ── Brand ──────────────────────────────────────────────────── */
      --brand:      #1a9e96;  /* teal accent: header border, table header tint */
      --th-bg:      #b8dcdb;  /* parts-table header background */
      --th-border:  #9ccbca;  /* parts-table header border */

      /* ── Typography ─────────────────────────────────────────────── */
      --font-company:   16px;  /* company name in header */
      --font-doc-title: 28px;  /* document title */
      --font-doc-no:    20px;  /* document number */
      --font-doc-type:  14px;  /* document type label */
      --font-address:   14px;  /* address line */
      --font-body:      14px;  /* info table, cell text */
      --font-section:   18px;  /* section heading */
      --font-footer:    14px;  /* ⚠ SYNC → pdf-options footerTemplate font-size */
    }

    /* ===== PAGE LAYOUT (outer table — thead repeats on every page) ===== */
    .page-layout { width: 100%; border-collapse: collapse; table-layout: fixed; }

    .page-header  { padding: var(--pg-top) var(--pg-h) 0 var(--pg-h); }
    .page-content { padding: 4mm var(--pg-h) 8mm var(--pg-h); vertical-align: top; }

    /* Screen: A4 card centered */
    @media screen {
      html { background: #c0c0c0; padding: 24px 0 40px; }
      body { width: 210mm; margin: 0 auto; background: white; box-shadow: 0 2px 20px rgba(0,0,0,0.3); }
    }

    /* Print: ⚠ SYNC — keep this value equal to --pg-bottom AND pdf-options margin.bottom */
    @media print {
      @page { margin-bottom: 20mm; }
      .parts-table tbody tr { page-break-inside: avoid; }
    }

    /* ===== HEADER INTERNALS ===== */
    .hdr-top    { display: flex; align-items: center; justify-content: space-between; margin-bottom: 2px; }
    .hdr-bottom { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 4px; }
    .hdr-left   { display: flex; align-items: center; gap: 12px; flex: 1; min-width: 0; }
    .hdr-right  { flex-shrink: 0; text-align: right; }

    .hdr-logo { width: auto; max-width: 240px; object-fit: contain; }

    .company-info { display: flex; flex-direction: column; justify-content: center; }
    .company-th { font-weight: 700; font-size: var(--font-company); line-height: 1.3; color: #000; white-space: nowrap; }
    .company-en { font-weight: 600; font-size: var(--font-company); line-height: 1.3; color: #000; white-space: nowrap; }

    .doc-title  { font-size: var(--font-doc-title); font-weight: 700; color: #000; line-height: 1.1; white-space: nowrap; }

    .hdr-doc-info { text-align: right; }
    .doc-number { font-size: var(--font-doc-no);   font-weight: 700; color: #000; margin-top: -8px; }
    .doc-type   { font-size: var(--font-doc-type); color: #000; margin-top: 1px; }

    .hdr-address { font-size: var(--font-address); color: #000; line-height: 1.35; }
    .hdr-border  { height: 2px; background: var(--brand); margin-top: 4px; }

    /* ===== INFO TABLE ===== */
    .info-table { width: 100%; table-layout: fixed; border-collapse: collapse; font-size: var(--font-body); margin-bottom: 6mm; }
    .info-table td { padding: 4px 12px; vertical-align: top; border: none; }
    .info-table td:first-child,
    .info-table td:nth-child(3) { padding-left: 0; }
    .info-table .lbl { font-weight: 700; color: #000; white-space: nowrap; width: 18%; }
    .info-table .val { color: #000; }

    /* ===== SECTION TITLE ===== */
    .section-title { font-weight: 700; font-size: var(--font-section); padding: 0; margin: -4px 0 8px 0; color: #000; }

    /* ===== PARTS TABLE ===== */
    .parts-table { width: 100%; table-layout: fixed; border-collapse: collapse; }

    .parts-table th {
      background: var(--th-bg); color: #000; font-weight: 700;
      padding: 5px 4px; text-align: center;
      border: 1px solid var(--th-border); line-height: 1.3;
      font-size: var(--font-body);
    }

    .parts-table td { border: 1px solid #ccc; padding: 4px; vertical-align: middle; overflow-wrap: break-word; font-size: var(--font-body); }
    .parts-table tbody tr:nth-child(even) td { background: #fff; }

    /* Column widths: 12 + 6×5 + 2×13 = 68% → col-matname gets remaining 32% */
    /* col-price 13% ≈ 25mm — fits up to 5-digit + 2 decimal (e.g. 99,999.00) */
    .col-matid   { width: 12%; }
    .col-num     { width: 5%; }
    .col-price   { width: 13%; }

    .td-matid  { text-align: center; }
    .td-num    { text-align: center; }
    .td-price  { text-align: right; }
  </style>
</head>
<body>

<!-- ===== OUTER LAYOUT TABLE — thead repeats on every page natively ===== -->
<table class="page-layout">
  <thead>
    <tr>
      <td class="page-header">
        <div class="hdr-top">
          <div class="hdr-left">
            <img src="/assets/images/mazuma-logo.png" alt="Mazuma" class="hdr-logo">
            <div class="company-info">
              <div class="company-th">บริษัท มาซูม่า เซอร์วิส จำกัด</div>
              <div class="company-en">MAZUMA SERVICE CO., LTD.</div>
            </div>
          </div>
          <div class="hdr-right">
            <div class="doc-title">ใบยืมสินค้า/อะไหล่</div>
          </div>
        </div>
        <div class="hdr-bottom">
          <div class="hdr-address">
            1296/9-10 ถนนกรุงเทพ-นนทบุรี แขวงบางซื่อ เขตบางซื่อ กรุงเทพฯ 10800<br>
            1296/9-10 Bangkok-Nonthaburi Rd., Bangsue, Bangsue, Bangkok 10800
          </div>
          <div class="hdr-doc-info">
            <div class="doc-number">{{documentNo}}</div>
            <div class="doc-type">{{documentType}}</div>
          </div>
        </div>
        <div class="hdr-border"></div>
      </td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="page-content">

        <table class="info-table">
          <tr>
            <td class="lbl">ชื่อลูกค้า</td>
            <td class="val">{{customerName}}</td>
            <td class="lbl">ชื่อช่าง (รหัสคลังช่าง)</td>
            <td class="val">{{technicianName}} ({{technicianWarehouse}})</td>
          </tr>
          <tr>
            <td class="lbl">ชื่อสินค้า</td>
            <td class="val">{{productName}}</td>
            <td class="lbl">วันที่เปิดใบยืม</td>
            <td class="val">{{dateFormat openDate}}</td>
          </tr>
          <tr>
            <td class="lbl">รหัสสินค้า</td>
            <td class="val">{{productCode}}</td>
            <td class="lbl">ศูนย์บริการ</td>
            <td class="val">{{serviceCenter}}</td>
          </tr>
          <tr>
            <td class="lbl">เลขที่ใบสั่งงาน</td>
            <td class="val">{{workOrderNo}}</td>
            <td class="lbl">ช่างผู้จัดใบยืม</td>
            <td class="val">{{managedBy}}</td>
          </tr>
          <tr>
            <td class="lbl">ประเภทใบงาน</td>
            <td class="val">{{workOrderType}}</td>
            <td class="lbl">ชื่อคลังผู้จ่ายของ</td>
            <td class="val">{{senderWarehouse}}</td>
          </tr>
          <tr>
            <td class="lbl">วันที่ที่วิ่งงาน</td>
            <td class="val">{{dateFormat runDate}}</td>
            <td class="lbl">ชื่อคลังผู้รับคืน</td>
            <td class="val">{{valueOrDash receiverWarehouse}}</td>
          </tr>
        </table>

        <div class="section-title">อะไหล่ที่ยืม</div>

        <table class="parts-table">
          <thead>
            <tr>
              <th class="col-matid">MAT<br>Unit ID</th>
              <th class="col-matname">MAT Name</th>
              <th class="col-num">ยืม</th>
              <th class="col-num">จ่าย</th>
              <th class="col-num">ฟรี</th>
              <th class="col-num">ขาย</th>
              <th class="col-num">คง<br>ค้าง</th>
              <th class="col-num">คืน</th>
              <th class="col-price">ราคา/<br>หน่วย</th>
              <th class="col-price">ราคา<br>ขาย</th>
            </tr>
          </thead>
          <tbody>
            {{#each parts}}
            <tr>
              <td class="td-matid">{{this.matUnitId}}</td>
              <td class="td-matname">{{this.matName}}</td>
              <td class="td-num">{{valueOrDash this.borrowed}}</td>
              <td class="td-num">{{valueOrDash this.issued}}</td>
              <td class="td-num">{{valueOrDash this.free}}</td>
              <td class="td-num">{{valueOrDash this.sold}}</td>
              <td class="td-num">{{valueOrDash this.remaining}}</td>
              <td class="td-num">{{valueOrDash this.returned}}</td>
              <td class="td-price">{{numberFormat this.unitPrice 2}}</td>
              <td class="td-price">{{numberFormat this.salePrice 2}}</td>
            </tr>
            {{/each}}
          </tbody>
        </table>

      </td>
    </tr>
  </tbody>
</table>

<!--
  pdf-options: values below must stay in sync with :root variables (CSS var() not supported in JSON)
    margin.bottom  ⚠ SYNC with  --pg-bottom  and  @page { margin-bottom }
    padding-right  ⚠ SYNC with  --pg-h
    font-size      ⚠ SYNC with  --font-footer
-->
<script type="application/pdf-options">
{
  "margin": { "top": "0", "right": "0", "bottom": "20mm", "left": "0" },
  "footerTemplate": "<div style='font-family:\"Bai Jamjuree\",sans-serif;font-size:14px;width:100%;text-align:right;padding-right:8mm;box-sizing:border-box;'><span class='pageNumber'></span> / <span class='totalPages'></span></div>"
}
</script>

</body>
</html>
